<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>HTTP权威指南 (图灵程序设计丛书)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos423709" class="calibre_"><span class="calibre3"><span class="bold">6.4　客户端的代理设置</span></span></p><p class="calibre_">所有现代的 Web 浏览器都允许用户对代理的使用进行配置。实际上，很多浏览器都提供了多种配置代理的方式，其中包括以下几种。</p><div class="calibre_5"> </div><ul class="calibre_6"><li value="1" class="calibre_7"><p class="calibre_"><span class="bold">手工配置</span></p><p class="calibre_">显式地设置要使用的代理。</p></li><li value="2" class="calibre_7"><p class="calibre_"><span class="bold">预先配置浏览器</span></p><p class="calibre_">浏览器厂商或发行商会在将浏览器发送给其客户之前预先对浏览器（或所有其他 Web 客户端）的代理设置进行手工配置。</p></li><li value="3" class="calibre_7"><p class="calibre_"><span class="bold">代理的自动配置</span>（Proxy Auto-Configuration，PAC）</p><p class="calibre_">提供一个 URI，指向一个用 JavaScript 语言编写的<span class="bold">代理自动配置</span>文件；客户端会取回这个 JavaScript 文件，并运行它以决定是否应该使用一个代理，如果是的话，应该使用哪个代理服务器。</p></li><li value="4" class="calibre_7"><p class="calibre_"><span class="bold">WPAD 的代理发现</span></p><p class="calibre_">有些浏览器支持 Web 代理自动发现协议（Web Proxy Autodiscovery Protocol，WPAD），这个协议会自动检测出浏览器可以从哪个“配置服务器”下载到一个自动配置文件。<sup class="calibre4"><small class="calibre5"><span class="calibre6">1</span></small></sup></p><p class="calibre_"><sup class="calibre4"><small class="calibre5"><span class="calibre6">1 当前只有 Internet Explorer 支持这一特性。</span></small></sup></p></li></ul><p class="calibre_"><span class="calibre3"><span class="bold">6.4.1　客户端的代理配置：手工配置</span></span></p><p class="calibre_">很多 Web 客户端都允许用户手工配置代理。网景的 Navigator 和微软的 Internet Explorer 都为代理配置提供了便捷的支持。</p><p class="calibre_">在网景的 Navigator 6 中，可以通过菜单选项 Edit（编辑）→ Preferences（首选项）→ Advanced（高级）→ Proxies（代理），然后选中单选按钮“Manual proxy”（手工配置代理）来指定代理。</p><p class="calibre_">在微软的 Internet Explorer 5 中，可以在 Tools（工具）→ Internet Options（Internet 选项）菜单中，选择一个连接，点击“Settings”（设置），选中“Use a proxy server”（使用代理服务器）框，并点击“Advanced”（高级），来手工指定代理。</p><p class="calibre_">其他浏览器都有不同的方式来进行手工配置的修改，但其思想是一样的：为代理指定主机和端口。有些 ISP 会向客户发送预先配置好的浏览器，或定制好的操作系统，使其将 Web 流量重定向到代理服务器上。</p><p class="calibre_"><span class="calibre3"><span class="bold">6.4.2　客户端代理配置：PAC文件</span></span></p><p class="calibre_">手工代理配置很简单但有些死板。只能为所有内容指定唯一的一个代理服务器，而且不支持故障转移。手工代理配置还会给大型组织带来管理问题。如果配置过的浏览器基数很大，那么需要进行修改的时候，重新配置每个浏览器是非常困难，甚至是不可能的。</p><p class="calibre_">PAC 文件是一些小型的 JavaScript 程序，可以在运行过程中计算代理设置，因此，是一种更动态的代理配置解决方案。访问每个文档时，JavaScript 函数都会选择恰当的代理服务器。</p><p class="calibre_">要使用 PAC 文件，就要用 JavaScript PAC 文件的 URI 来配置浏览器［配置方式与手工配置类似，但要在“automatic configuration”（自动配置）框中提供一个 URI］。浏览器会从这个 URI 上获取 PAC 文件，并用 JavaScript 逻辑为每次访问计算恰当的代理服务器。PAC 文件的后缀通常是 .pac，MIME 类型通常是 application/x-ns- proxy-autoconfig。</p><p class="calibre_">每个 PAC 文件都必须定义一个名为 <tt class="calibre8">FindProxyForURL(url,host)</tt> 的函数，用来计算访问 URI 时使用的适当的代理服务器。函数的返回值可以是表 6-1 列出的任意值。</p><p class="calibre_"><span class="bold">表6-1　代理自动配置脚本的返回值</span></p><p class="calibre2" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" class="calibre_14"><tr valign="top" class="calibre9"><th valign="top" class="calibre_20"><span class="calibre7"><span class="bold"> </span></span><span class="calibre11"><tt class="calibre8"><span class="bold">FindProxyForURL </span></tt></span><span class="calibre7"><span class="bold">的返回值</span></span>
</th><th valign="top" class="calibre_20"><span class="calibre7"><span class="bold"> 描　　述 </span></span>
</th></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> </span><span class="calibre11"><tt class="calibre8">DIRECT </tt></span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> 不经过任何代理，直接进行连接 </span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> </span><span class="calibre11"><tt class="calibre8">PROXY host:port </tt></span>
</td><td valign="top" class="calibre10"><span class="calibre7"> 应该使用指定的代理 </span>
</td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> </span><span class="calibre11"><tt class="calibre8">SOCKS host:port </tt></span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> 应该使用指定的 </span><span class="calibre11"><tt class="calibre8">SOCKS </tt></span><span class="calibre7"> 服务器</span><span class="calibre_18">
</span></td></tr></table><p class="calibre_">例 6-1 中的 PAC 文件为 HTTP 事务处理指定了一个代理，为 FTP 事务处理指定了另一个代理，并为所有其他类型的事务处理使用直连方式。</p><blockquote class="calibre_21"><span class="bold">例 6-1</span>　代理自动配置文件示例</blockquote><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">function FindProxyForURL(url, host) {<br class="calibre2"/>    if (url.substring(0,5) == "http:") {<br class="calibre2"/>        return "PROXY http-proxy.mydomain.com:8080";<br class="calibre2"/>    } else if (url.substring(0,4) =="ftp:") {<br class="calibre2"/>        return "PROXY ftp-proxy.mydomain.com:8080";<br class="calibre2"/>    } else {<br class="calibre2"/>        return "DIRECT";<br class="calibre2"/>    }<br class="calibre2"/>}<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">更多有关 PAC 文件的细节，请参见第 20 章。</p><p class="calibre_"><span class="calibre3"><span class="bold">6.4.3　客户端代理配置：WPAD</span></span></p><p class="calibre_">另一种浏览器配置机制是 WPAD 协议。WPAD 协议的算法会使用发现机制的逐级上升策略自动地为浏览器查找合适的 PAC 文件。实现 WPAD 协议的客户端需要：</p><div class="calibre_5"> </div><ul class="calibre_6"><li value="1" class="calibre_7"><p class="calibre_">用 WPAD 找到 PAC 的 URI；</p></li><li value="2" class="calibre_7"><p class="calibre_">从指定的 URI 获取 PAC 文件；</p></li><li value="3" class="calibre_7"><p class="calibre_">执行 PAC 文件来判定代理服务器；</p></li><li value="4" class="calibre_7"><p class="calibre_">为请求使用代理服务器。</p></li></ul><p class="calibre_">WPAD 会使用一系列的资源发现技术来判定适当的 PAC 文件。并不是所有组织都能够使用所有的发现技术，所以 WPAD 使用了很多种发现技术。WPAD 会一个接一个地对每种技术进行尝试，直到成功为止。</p><p class="calibre_">当前的 WPAD 协议规范按顺序定义了下列技术：</p><div class="calibre_5"> </div><ul class="calibre_6"><li value="1" class="calibre_7"><p class="calibre_">动态主机配置协议（Dynamic Host Configuration Protocol，DHCP）；</p></li><li value="2" class="calibre_7"><p class="calibre_">服务定位协议（Service Location Protocol，SLP）；</p></li><li value="3" class="calibre_7"><p class="calibre_">DNS 知名主机名；</p></li><li value="4" class="calibre_7"><p class="calibre_">DNS SRV 记录；</p></li><li value="5" class="calibre_7"><p class="calibre_">TXT 记录中的 DNS 服务 URI。</p></li></ul><p class="calibre_">更多信息，请参阅第 20 章。</p><div class="mbp_pagebreak" id="calibre_pb_63"></div>
</body></html>
