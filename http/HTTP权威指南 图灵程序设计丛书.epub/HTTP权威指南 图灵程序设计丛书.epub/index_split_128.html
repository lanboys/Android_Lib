<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>HTTP权威指南 (图灵程序设计丛书)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos872294" class="calibre_"><span class="calibre3"><span class="bold">13.3　增强保护质量</span></span></p><p class="calibre_">可以在三种摘要首部中提供 <tt class="calibre8">qop</tt> 字段：<tt class="calibre8">WWW-Authenticate</tt>、<tt class="calibre8">Authorization</tt> 和 <tt class="calibre8">Authentication-Info</tt>。</p><p class="calibre_">通过 <tt class="calibre8">qop</tt> 字段，客户端和服务器可以对不同类型及质量的保护进行协商。比如，即便会严重降低传输速度，有些事务可能也要检查报文主体的完整性。</p><p class="calibre_">服务器首先在 <tt class="calibre8">WWW-Authenticate</tt> 首部输出由逗号分隔的 <tt class="calibre8">qop</tt> 选项列表。然后客户端从中选择一个它支持且满足其需求的选项，并将其放在 <tt class="calibre8">Authorization</tt> 的 <tt class="calibre8">qop</tt> 字段中回送给服务器。</p><p class="calibre_"><tt class="calibre8">qop</tt> 字段是可选的，但只是在后向兼容原有 RFC 2069 规范的情况下才是可选的。现代所有的摘要实现都应该支持 <tt class="calibre8">qop</tt> 选项。</p><p class="calibre_">RFC 2617 定义了两种保护质量的初始值：表示认证的 <tt class="calibre8">auth</tt>，带有报文完整性保护的认证 <tt class="calibre8">auth-int</tt>。将来可能还会出现其他 <tt class="calibre8">qop</tt> 选项。</p><p class="calibre_"><span class="calibre3"><span class="bold">13.3.1　报文完整性保护</span></span></p><p class="calibre_">如果使用了完整性保护（<tt class="calibre8">qop="auth-int"</tt>），H（实体的主体部分）就是对实体主体部分，而不是报文主体部分的散列。对于发送者，要在应用任意传输编码方式之前计算；而对于接收者，则应在去除所有传输编码之后计算。注意，对于任何含有多部份的内容类型来说，多部分的边界和每部分中嵌入的首部都要包含在内。</p><p class="calibre_"><span class="calibre3"><span class="bold">13.3.2　摘要认证首部</span></span></p><p class="calibre_">基本认证和摘要认证协议都包含了 <tt class="calibre8">WWW-Authenticate</tt> 首部承载的授权质询、<tt class="calibre8">Authorization</tt> 首部承载的授权响应。摘要认证还添加了可选的 <tt class="calibre8">Authorization-Info</tt> 首部，这个首部是在成功认证之后发送的，用于实现三步握手机制，并传送下一个随机数。表 13-8 给出了基本认证和摘要认证的首部。</p><p class="calibre_"><span class="bold">表13-8　HTTP认证首部</span></p><p class="calibre2" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" class="calibre_14"><tr valign="top" class="calibre9"><th valign="top" class="calibre_163"><span class="calibre7"><span class="bold"> 阶段 </span></span>
</th><th valign="top" class="calibre_69"><span class="calibre7"><span class="bold"> 基　　本 </span></span>
</th><th valign="top" class="calibre_20"><span class="calibre7"><span class="bold"> 摘　　要 </span></span>
</th></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> 质询 </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> </span><p class="calibre_134"><span class="calibre11"><tt class="calibre8">WWW-Authenticate: Basic </tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">realm="&lt;realm-value&gt;"</tt></span></p></td><td valign="top" class="calibre10"><span class="calibre7"> </span><p class="calibre_134"><span class="calibre11"><tt class="calibre8">WWW-Authenticate: Digest </tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    realm="&lt;realm-value&gt;"</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    nonce="&lt;nonce-value&gt;"</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [domain="&lt;list-of-URIs&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [opaque="&lt;opaque-token-value&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [stale=&lt;true-or-false&gt;]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [algorithm=&lt;digest-algorithm&gt;]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [qop="&lt;list-of-qop-values&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [&lt;extension-directive&gt;]</tt></span></p></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> 响应 </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> </span><p class="calibre_134"><span class="calibre11"><tt class="calibre8">Authorization: Basic </tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">&lt;base64(user:pass)&gt;</tt></span></p></td><td valign="top" class="calibre10"><span class="calibre7"> </span><p class="calibre_134"><span class="calibre11"><tt class="calibre8">Authorization: Digest </tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    username="&lt;username&gt;"</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    realm="&lt;realm-value&gt;"</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    nonce="&lt;nonce-value&gt;"</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    uri=&lt;request-uri&gt;</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    response="&lt;32-hex-digit-digest&gt;"</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [algorithm=&lt;digest-algorithm&gt;]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [opaque="&lt;opaque-token-value&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [cnonce="&lt;nonce-value&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [qop=&lt;qop-value&gt;]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [nc=&lt;8-hex-digit-nonce-count&gt;]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [&lt;extension-directive&gt;]</tt></span></p></td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> </span><span class="calibre11"><tt class="calibre8">Info </tt></span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> </span><span class="calibre11"><tt class="calibre8">n/a </tt></span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> </span><p class="calibre_134"><span class="calibre11"><tt class="calibre8">Authentication-Info: </tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    nextnonce="&lt;nonce-value&gt;"</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [qop="&lt;list-of-qop-values&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [rspauth="&lt;hex-digest&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [cnonce="&lt;nonce-value&gt;"]</tt></span><br class="calibre2"/><span class="calibre11"><tt class="calibre8">    [nc=&lt;8-hex-digit-nonce-count&gt;]</tt></span></p></td></tr></table><p class="calibre_">摘要认证首部要复杂得多。详细介绍参见附录 F。 </p><div class="mbp_pagebreak" id="calibre_pb_128"></div>
</body></html>
