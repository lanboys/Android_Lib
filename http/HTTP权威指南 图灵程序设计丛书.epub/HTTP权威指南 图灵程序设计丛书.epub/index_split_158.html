<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>HTTP权威指南 (图灵程序设计丛书)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos1068845" class="calibre_"><span class="calibre3"><span class="bold">16.2　字符集与 HTTP</span></span></p><p class="calibre_">现在我们进入主题，开始研究网站国际化中最重要（且令人困惑）的方面——各国的字母表和它们的字符集编码。</p><p class="calibre_">Web 字符集标准很有些令人迷惑。由于必须阅读很多标准文档，其中术语复杂且不一致，再加上对外语不太熟悉，很多人首次尝试编写国际化的网站软件时，都被搞糊涂了。本节和下一节应该能让读者更容易地学会在 HTTP 中使用字符集。</p><p class="calibre_"><span class="calibre3"><span class="bold">16.2.1　字符集是把字符转换为二进制码的编码</span></span></p><p class="calibre_">HTTP 字符集的值说明如何把实体内容的二进制码转换为特定字母表中的字符。每个字符集标记都命名了一种把二进制码转换为字符的算法（反之亦然）。字符集标记在由 IANA 维护（参见 <a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a>）的 MIME 字符集注册机构进行了标准化。附录 H 中概述了其中的很多字符集。</p><p class="calibre_">下面的 <tt class="calibre8">Content-Type</tt> 首部告知接收者，传输的内容是一份 HTML 文件，用 <tt class="calibre8">charset</tt> 参数告知接收者使用 iso-8859-6 阿拉伯字符集的解码算法把内容中的二进制码转换为字符：</p><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">Content-Type: text/html; charset=iso-8859-6<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">iso-8859-6 的编码算法把 8 位值域映射为拉丁字母和阿拉伯字母，以及数字，标点和其他符号 <sup class="calibre4"><small class="calibre5"><span class="calibre6">1</span></small></sup>。例如，在图 16-1 中，突出显示的二进制码的值是 225，它在 iso-8859-6 中被映射到阿拉伯字母“FEH”（读音类似英语字母 F）。</p><p class="calibre_"><sup class="calibre4"><small class="calibre5"><span class="calibre6">1 与汉语、日语不同的是，阿拉伯语中只有 28 个字符。8 位空间有 256 个不同的值，足以容纳拉丁字符、阿拉伯字符以及其他符号。</span></small></sup></p><p class="calibre_8"><img src="images/00113.jpg" class="calibre_186"/></p><p class="calibre_10"><span class="calibre7">图 16-1　</span><span class="calibre7"><tt class="calibre8">charset</tt></span><span class="calibre7"> 参数告知客户端如何把内容中的二进制码转换为字符</span></p><p class="calibre_">有些字符编码（比如 UTF-8 和 iso-2022-jp）更加复杂，它们是<span class="bold">可变长</span>（variable- length）编码，也就是说每个字符的位数都是可变的。这种类型的编码允许使用额外 的二进制位表示拥有大量字符的字母表（比如汉语和日语），仅用较少的二进制位来 表示标准的拉丁字符。</p><p class="calibre_"><span class="calibre3"><span class="bold">16.2.2　字符集和编码如何工作</span></span></p><p class="calibre_">现在我们来看看字符集和编码到底做了什么。</p><p class="calibre_">我们想把文档中的二进制码转换为字符以便显示在屏幕上。但由于有很多不同的字母表，也有很多不同的方法把字符编码成二进制码（这些方法各有优缺点），我们需要一种标准方法来描述并应用把二进制码转换为字符的解码算法。</p><p class="calibre_">把二进制码转换为字符要经过两个步骤，如图 16-2 所示。</p><p class="calibre_8"><img src="images/00158.jpg" class="calibre_120"/></p><p class="calibre_10"><span class="calibre7">图 16-2　HTTP 协议中的 </span><span class="calibre7"><tt class="calibre8">charset</tt></span><span class="calibre7"> 是字符编码方案和编码后字符集的组合</span></p><div class="calibre_5"> </div><ul class="calibre_6"><li value="1" class="calibre_7"><p class="calibre_">在图 16-2a 中，文档中的二进制码被转换成字符代码，它表示了特定编码字符集中某个特定编号的字符。在这个例子里，解码后的字符代码是数字编号 225。</p></li><li value="2" class="calibre_7"><p class="calibre_">在图 16-2b 中，字符代码用于从编码的字符集中选择特定的元素。在 iso-8859-6 中，值 225 对应阿拉伯字母“FEH”。在步骤 a 和 b 中使用的算法取决于 MIME 的 <tt class="calibre8">charset</tt> 标记。</p></li></ul><p class="calibre_">国际化字符系统的关键目标是把语义（字母）和表示（图形化的显示形式）隔离开来。HTTP 只关心字符数据和相关语言及字符集标签的传输。字符形状的显示是由用户的图形显示软件（包括浏览器、操作系统、字体等）完成的，如图 16-2c 所示。</p><p class="calibre_"><span class="calibre3"><span class="bold">16.2.3　字符集不对，字符就不对</span></span></p><p class="calibre_">如果客户端使用了错误的字符集参数，客户端就会显示一些奇怪的错乱字符。假设浏览器从主体中获得值 225（二进制为 11100001）。</p><div class="calibre_5"> </div><ul class="calibre_6"><li value="1" class="calibre_7"><p class="calibre_">如果浏览器认为主体是用 iso-8859-1 西欧字符编码的，它将会显示带有重音符号的小写拉丁字母“a”：</p><p class="calibre_8"><img src="images/00164.jpg" class="calibre_187"/></p></li><li value="2" class="calibre_7"><p class="calibre_">如果浏览器使用 iso-8859-6 阿拉伯编码，它将会显示阿拉伯字母“FEH”：</p><p class="calibre_8"><img src="images/00192.jpg" class="calibre_188"/></p></li><li value="3" class="calibre_7"><p class="calibre_">如果浏览器使用 iso-8859-7 希腊编码，它将会显示小写的希腊字母“Alpha”：</p><p class="calibre_8"><img src="images/00155.jpg" class="calibre_189"/></p></li><li value="4" class="calibre_7"><p class="calibre_">如果浏览器使用 iso-8859-8 希伯来编码，它将会显示希伯来字母“BET”：</p><p class="calibre_8"><img src="images/00055.jpg" class="calibre_190"/></p></li></ul><p class="calibre_"><span class="calibre3"><span class="bold">16.2.4　标准化的MIME </span></span><span class="calibre3"><tt class="calibre8"><span class="bold">charset</span></tt></span><span class="calibre3"><span class="bold">值</span></span></p><p class="calibre_">特定的字符编码方案和特定的已编码字符集组合成一个 <span class="bold">MIME 字符集</span>（MIME charset）。HTTP 在 <tt class="calibre8">Content-Type</tt> 和 <tt class="calibre8">Accept-Charset</tt> 首部中使用标准化的 MIME <tt class="calibre8">charset</tt> 标记。MIME <tt class="calibre8">charset</tt> 的值都会在 IANA 注册。<sup class="calibre4"><small class="calibre5"><span class="calibre6">2</span></small></sup> 表 16-1 列出了文档和浏览器所使用的一些 MIME <tt class="calibre8">charset</tt> 编码方案。更完整的列表参见附录 H。</p><p class="calibre_"><sup class="calibre4"><small class="calibre5"><span class="calibre6">2 请从 http://www.iana.org/numbers.htm http://www.iana.org/numbers.htm获取注册的 charset 值的完整列表。</span></small></sup></p><p class="calibre_"><span class="bold">表16-1　MIME </span><tt class="calibre8"><span class="bold">charset</span></tt><span class="bold"> 编码标记</span></p><p class="calibre2" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" class="calibre_14"><tr valign="top" class="calibre9"><th valign="top" class="calibre_66"><span class="calibre7"><span class="bold"> MIME </span></span><span class="calibre11"><tt class="calibre8"><span class="bold">charset </span></tt></span><span class="calibre7"><span class="bold"> 值</span></span>
</th><th valign="top" class="calibre_68"><span class="calibre7"><span class="bold"> 描　　述 </span></span>
</th></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> us-ascii </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> 这是个著名的字符编码，在 1968 年就已标准化，称为ANSI_X3.4-1968。它也称为ASCII，但最好还是加上“US”前缀，因为 ISO 646 中有某些国际化的变体，它们修改了一些字符。US-ASCII 把 7 位数值映射到 128 个字符上。最高位未使用 </span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-1 </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-1 是对 ASCII 的 8 位扩展，以支持西欧的多种语言。它使用了最高位以包含更多西欧字符，而保持 ASCII 的编码部分（0 ～ 127）没有变。它也称为isolatin-1，或简称为 Latin1 </span>
</td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-2 </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> 对 ASCII 扩展以包括中欧和东欧语言中的字符，包括捷克、波兰、罗马尼亚。它也称为 iso-latin-2 </span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-5 </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> 对 ASCII 扩展以包括斯拉夫语字符，使用这些字符的语言包括俄语、塞尔维亚语和保加利亚语 </span>
</td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-6 </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> 对 ASCII 扩展以包括阿拉伯语字符。因为阿拉伯语字符的显示形状会随它在单词中的位置而变化，阿拉伯语的显示引擎需要分析上下文来为每个字符生成正确的形状 </span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-7 </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> 对 ASCII 扩展以包括现代希腊语字符。以前称为 ELOT-928 或 ECMA-118:1986 </span>
</td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-8 </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> 对 ASCII 扩展以包括希伯来语和意第绪语（这两种语言都是犹太人所用的）的字符 </span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> iso-8859-15 </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> 更新了 iso-8859-1，用遗漏的法语和芬兰语字母替换了一些不太常用的标点符号和分数符号，并用新的欧元符号替换国际货币符号。这种字符集简称为 Latin0，可能将来会替代 iso-8859-1，作为欧洲的首选默认字符集 </span>
</td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> iso-2022-jp </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> iso-2022-jp 是在日语的电子邮件和网页内容中广泛使用的编码。它是一种变长编码方案，支持用单字节表示 ASCII 字符，但使用 3 字符的模态转义序列在 3 种日语字符集中切换 </span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> euc-jp </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> euc-jp 是遵循 ISO 2022 的变长编码，它用显式的二进制码模式来标识每个字符，不需要模态及转义序列。它使用单字节、2 字节以及 3 字节的序列来标识多个日语字符集中的字符 </span>
</td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> Shift_JIS </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> 该编码起初是由微软公司开发的，有时称为 SJIS 或 MS Kanji。出于保持历史兼容性方面的原因，它有点儿复杂，并且不能映射所有的字符，不过它还是用的很普遍 </span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> koi8-r </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> KOI8-R 是为俄语设计的流行的 8 位因特网字符集编码，在 IETF RFC 1489 中定义。这些大写字母是 Code for Information Exchange, 8 bit, Russian（俄语 8 位信息交换代码）的首字母缩略形式 </span>
</td></tr><tr valign="top" class="calibre_17"><td valign="top" class="calibre10"><span class="calibre7"> utf-8 </span><span class="calibre_18">
</span></td><td valign="top" class="calibre10"><span class="calibre7"> UTF-8 是一种用来表示UCS（Unicode）的常用变长字符编码方案，UCS 的意思是 Universal Character Set of the world's characters（世界字符统一字符集）。</span><br class="calibre2"/><span class="calibre7"> </span><span class="calibre7">UTF-8 使用变长的编码来表示字符代码值，每个字符使用1 ～ 6 个字节。UTF-8 的主要特点之一就是保持对普通的 7 位 ASCII 文本的后向兼容性</span><span class="calibre_18">
</span></td></tr><tr valign="top" class="calibre9"><td valign="top" class="calibre10"><span class="calibre7"> windows-1252 </span>
</td><td valign="top" class="calibre10"><span class="calibre7"> 微软公司把它编码后的字符集称为 code page（代码页）。Windows 的代码页 1252（也称为 CP1252 或 WinLatin1）是对 iso-8859-1 的扩展 </span>
</td></tr></table><p class="calibre_"><span class="calibre3"><span class="bold">16.2.5　</span></span><span class="calibre3"><tt class="calibre8"><span class="bold">Content-Type</span></tt></span><span class="calibre3"><span class="bold">首部和</span></span><span class="calibre3"><tt class="calibre8"><span class="bold">Charset</span></tt></span><span class="calibre3"><span class="bold">首部以及META标志</span></span></p><p class="calibre_">Web 服务器通过在 <tt class="calibre8">Content-Type</tt> 首部中使用 <tt class="calibre8">charset</tt> 参数把 MIME 字符集标记发送给客户端：</p><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">Content-Type: text/html; charset=iso-2022-jp<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">如果没有显式地列出字符集，接收方可能就要设法从文档内容中推断出字符集。对于 HTML 内容来说，可以在描述 <tt class="calibre8">charset</tt> 的 <tt class="calibre8">&lt;META HTTP-EQUIV="Content-Type"&gt;</tt> 标记中找到字符集。</p><p class="calibre_">例 16-1 中展示了 HTML META 标记如何把字符集设置为日语编码 iso-2022-jp。如果文档不是 HTML 类型，或其中没有 <tt class="calibre8">META Content-Type</tt> 标记，软件可以设法扫描实际的文本，看看能否找出语言和编码的常见模式，以此推断字符编码。</p><blockquote class="calibre_21"><span class="bold">例 16-1　可以在 HTML META 标记中规定字符编码</span></blockquote><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">&lt;HEAD&gt;<br class="calibre2"/>    &lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-2022-jp"&gt;<br class="calibre2"/>    &lt;META LANG="jp"&gt;<br class="calibre2"/>    &lt;TITLE&gt;A Japanese Document&lt;/TITLE&gt;<br class="calibre2"/>&lt;/HEAD&gt;<br class="calibre2"/>&lt;BODY&gt;<br class="calibre2"/>...<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">如果客户端无法推断出字符编码，就假定使用的是 iso-8859-1。</p><p class="calibre_"><span class="calibre3"><span class="bold">16.2.6　</span></span><span class="calibre3"><tt class="calibre8"><span class="bold">Accept-Charset</span></tt></span><span class="calibre3"><span class="bold">首部</span></span></p><p class="calibre_">在过去的几十年间，人们开发了成千上万种字符编解码方法。大多数客户端不可能支持所有这些不同的字符编码和映射系统。</p><p class="calibre_">HTTP 客户端可以使用 <tt class="calibre8">Accept-Charset</tt> 请求首部来明确告知服务器它支持哪些字符系统。<tt class="calibre8">Accept-Charset</tt> 首部的值列出了客户端支持的字符编码方案。例如，下面的 HTTP 请求首部表明，客户端接受西欧字符系统 iso-8859-1 和 UTF-8 变长的 Unicode 兼容系统。服务器可以随便选择这两种字符编码方案之一来返回内容。</p><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">Accept-Charset: iso-8859-1, utf-8<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">注意，没有 <tt class="calibre8">Content-Charset</tt> 这样的响应首部和 <tt class="calibre8">Accept-Charset</tt> 请求首部匹配。为了和 MIME 标准兼容，响应的字符集是由服务器通过 <tt class="calibre8">Content-Type</tt> 响应首部的 <tt class="calibre8">charset</tt> 参数带回来的。不对称真是太糟了，不过需要的信息倒是都有了。 </p><div class="mbp_pagebreak" id="calibre_pb_158"></div>
</body></html>
