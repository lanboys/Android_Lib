<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>HTTP权威指南 (图灵程序设计丛书)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos466921" class="calibre_"><span class="calibre3"><span class="bold">6.8　代理的互操作性</span></span></p><p class="calibre_">客户端、服务器和代理是由不同厂商构建的，实现的是不同版本的 HTTP 规范。它们支持的特性各不相同，也存在着不同的问题。代理服务器位于客户端和服务器设备之间，这些设备实现的协议可能有所不同，可能存在着很棘手的问题。</p><p class="calibre_"><span class="calibre3"><span class="bold">6.8.1　处理代理不支持的首部和方法</span></span></p><p class="calibre_">代理服务器可能无法理解所有经其传输的首部字段。有些首部可能比代理自身还要新；其他首部可能是特定应用程序独有的定制首部。代理必须对不认识的首部字段进行转发，而且必须维持同名首部字段的相对顺序。<sup class="calibre4"><small class="calibre5"><span class="calibre6">1</span></small></sup> 类似地，如果代理不熟悉某个方法，那么只要可能，就应该尝试着将报文转发到下一跳节点上去。</p><p class="calibre_"><sup class="calibre4"><small class="calibre5"><span class="calibre6">1 报文中可能会出现多个报文首部字段具有相同字段名的情况，如果存在这种情况的话，就要将其等价地合并为一个由逗号分隔的列表。因此，要对合并后的字段值进行解释，具有相同字段名的首部字段的接收顺序就变得非常重要了，因此，代理在转发报文时，就不能修改这些同名字段值的相对顺序。</span></small></sup></p><p class="calibre_">在当今的大部分网络中，如果代理不能转发它不支持的方法，可能就无法生存下去了，因为通过微软的 Outlook 进行 Hotmail 访问就大量地使用了 HTTP 扩展方法。</p><p class="calibre_"><span class="calibre3"><span class="bold">6.8.2　OPTIONS：发现对可选特性的支持</span></span></p><p class="calibre_">通过 HTTP OPTIONS 方法，客户端（或代理）可以发现 Web 服务器或者其上某个特定资源所支持的功能（比如，它们所支持的方法）（参见图 6-26）。通过使用 OPTIONS，客户端可以在与服务器进行交互之前，确定服务器的能力，这样它就可以更方便地与具备不同特性的代理和服务器进行互操作了。</p><p class="calibre_8"><img src="images/00156.jpg" class="calibre_93"/></p><p class="calibre_10"><span class="calibre7">图 6-26　用 OPTIONS 来判定服务器支持的方法</span></p><p class="calibre_">如果 OPTIONS 请求的 URI 是个星号（*），请求的就是整个服务器所支持的功能。比如：</p><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">OPTIONS * HTTP/1.1<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">如果 URI 是个实际资源地址，OPTIONS 请求就是在查询那个特定资源的可用特性：</p><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">OPTIONS http://www.joes-hardware.com/index.html HTTP/1.1<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">如果成功，OPTIONS 方法就会返回一个包含了各种首部字段的 200 OK 响应，这些 字段描述了服务器所支持的，或资源可用的各种可选特性。HTTP/1.1 在响应中唯一指定的首部字段是 <tt class="calibre8">Allow</tt> 首部，这个首部用于描述服务器所支持的各种方法（或者服务器上的特定资源）。<sup class="calibre4"><small class="calibre5"><span class="calibre6">2</span></small></sup> OPTIONS 允许在可选的响应主体中包含更多的信息，但并没有对这种用法进行定义。</p><p class="calibre_"><sup class="calibre4"><small class="calibre5"><span class="calibre6">2 并不是所有资源都支持每种方法的。比如，CGI 脚本查询可能就不支持文件 PUT，而静态的 HTML 文件则不接受 POST 方法。</span></small></sup></p><p class="calibre_"><span class="calibre3"><span class="bold">6.8.3　</span></span><span class="calibre3"><tt class="calibre8"><span class="bold">Allow</span></tt></span><span class="calibre3"><span class="bold"> 首部</span></span></p><p class="calibre_"><tt class="calibre8">Allow</tt> 实体首部字段列出了请求 URI 标识的资源所支持的方法列表，如果请求 URI 为 * 的话，列出的就是整个服务器所支持的方法列表。例如：</p><blockquote class="calibre_21"><span class="calibre7"><tt class="calibre8">Allow: GET, HEAD, PUT<br class="calibre2"/></tt></span></blockquote><p class="calibre_22">可以将 <tt class="calibre8">Allow</tt> 首部作为请求首部，建议在新的资源上支持某些方法。并不要求服务器支持这些方法，但应该在相应的响应中包含一个 <tt class="calibre8">Allow</tt> 首部，列出它实际支持的方法。</p><p class="calibre_">因为客户端可能已经通过其他途径与原始服务器进行了交流，所以即使代理无法理解指定的所有方法，也不能对 <tt class="calibre8">Allow</tt> 首部字段进行修改。</p><div class="mbp_pagebreak" id="calibre_pb_67"></div>
</body></html>
